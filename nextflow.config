// Nextflow config file

// Global default params, used in configs
params {
    // Input options
    bucket = null
    delivery = null
    sample_sheet = null

    // Output options
    outdir = null
    
    // SIZ options
    read_pairs_per_siz = 1000000
}

// container settings
docker.enabled = true
docker.runOptions = '-v $HOME/.aws/credentials:/credentials -e AWS_SHARED_CREDENTIALS_FILE=/credentials'
process.container = 'ghcr.io/naobservatory/read_sizer:latest' // suffices for all processes

// AWS Client settings
aws.client.maxConnections = 1000
aws.client.maxErrorRetry = 10
aws.client.connectionTimeout = 0
aws.client.socketTimeout = 0

profiles {
    standard { // Run on EC2 instance with local working directory
        process.errorStrategy = "retry"
        process.maxRetries = 3
    }
    ec2_s3 { // Run on EC2 instance with a S3 working directory
        fusion.enabled = true
        process.errorStrategy = "retry"
        process.maxRetries = 3
    }
}

workflow {
    output {
        enabled = true
        mode = "copy"
        overwrite = "standard"
    }
}

process {
    withName: 'COMPILE_BINARY' {
        cpus   = { 2      }
        memory = { 1.GB   }
        time   = { 5.m    }
    }

    withName: 'SPLIT_INTERLEAVE' {
        publishDir = [
            path: { meta.outdir },
            mode: 'move'
        ]
        cpus   = { 6      }
        memory = { 8.GB   }
        time   = { 2.h    }
    }
}
